% Lanczos 算法

\subsection{背景介绍}

在计算含时薛定谔方程时，若已知某时刻 $t$ 的波函数 $\Psi(\vec r,t)$，要求 $\Psi(\vec r,t+\Delta t)$，通常使用传播算符 % 链接未完成
 \begin{equation}
U(\Delta t) = \exp\left( -\frac{\I}{\hbar} \int_{t}^{t+\Delta t} \D t\vdot \hat H(t) \right)
\approx \exp\left(-\I\hat H(t+\Delta t/2) \Delta t \right)
\end{equation}
其中 $\hat H$ 为哈密顿算符．若 $\hat H$ 不含时，约等号变为等号
\begin{equation}
\Psi(\vec r, t+\Delta t) = \exp(-\I\hat H\Delta t/\hbar)\Psi(\vec r, t)
\end{equation}
通常情况下，用有限个正交归一基底 $\Psi_0,\dots\Psi_{K-1}$ 近似展开 $\Psi(\vec r,t+\Delta t)$，这时，$\hat H$ 可以表示成矩阵的形式．
\begin{equation}
H_{ij} = \bra{\Psi_i} \hat H \ket{\Psi_j}
\end{equation}
这样，幺正算符 $\exp(-\I\hat H\Delta t/\hbar)$ 也可以表示成矩阵．根据定义 % 链接未完成
\begin{equation}
\exp(-\I\hat H\Delta t/\hbar) = 1+(-\I\hat H\Delta t/\hbar) = 1+(-\I\hat H\Delta t/\hbar) + \frac{1}{2!}(-\I\hat H\Delta t/\hbar)^2\dots
\end{equation}
此时若把 $\hat H$ 对角化（求解本征方程），得到本征矢列矩阵 $\mat P$ （单位正交阵）以及本征值矩阵 $\mat \Lambda$ （对角矩阵），则可进行基底变换变到 $\hat H$ 矩阵的本征空间求解上式 %（矩阵指数的对角化化简，未完成）
\begin{equation}\begin{aligned}
\exp(-\I\hat H\Delta t/\hbar) &= P\times diag(\E^{-\I E_1 t/\hbar},\E^{-\I E_2 t/\hbar}\dots \E^{-\I E_N t/\hbar})\times P_{jk}^{-1}\\
&= \sum_{j=0}^{K-1} P_{ij} \E^{-\I E_j t/\hbar} P_{jk}^{-1}
= \sum_{j=0}^{K-1} P_{ij}P_{kj} \E^{-\I E_j t/\hbar} 
\end{aligned}\end{equation}
要说明的是，这种算法的误差（除数值计算误差）来源于两个方面，第一是用 $\exp(\I\hat H\Delta t/\hbar)$ 代替 $\exp\left( -\frac{\I}{\hbar} \int_{t}^{t+\Delta t} \D t\vdot \hat H(t) \right)$， 但如果 不含时就没有该误差，第二是有限数量的基底不具有完备性，这个误差可以随着基底数量增加而减小．

\subsection{Lanczos算法}
在以上的算法中，选取施密特正交归一化 %(链接未完成)
的 Krilov 基底作为基底．令 $\Psi_0 \equiv \Psi(\vec r, t)$，  $K$ 阶的 Krilov 基底为
 \begin{equation}
\left\{ \ket{\Psi_0}, \hat H \ket{\Psi_0}, \hat H^2 \ket{\Psi_0} \dots \hat H^{K-1} \ket{\Psi_0} \right\}
\end{equation}
我们把正交归一化后的基底记为
 \begin{equation}
\left\{ \ket{\Psi_0}, \ket{\Psi_1}, \ket{\Psi_2} \dots \ket{\Psi_{K-1}} \right\}
\end{equation}
这样，用其展开哈密顿算符
\begin{equation}
H_{ij}=\bra{\Psi_i} H \ket{\Psi_j}
\end{equation}
在算法上，本来我们可以按部就班地按照以上步骤做，然而由于 Krilov 基底的性质，可以通过一些定理（见词条最后）大大减少计算量．正交归一化步骤如下

\begin{enumerate}
\item 如果 $\Psi(\vec r,t)$ 没有归一化，将其进行归一化 $\ket{\Psi_0}=\Psi(\vec r,t)/\bra{\Psi(\vec r,t)}\ket{\Psi(\vec r,t)}$．
\item 把 $\Psi_1$ 进行施密特正交化， $\ket{\Psi_1}=\ket{\Psi_1}/\bra{\Psi(\vec r,t)}\ket{\Psi(\vec r,t)}$．  % 未完成
\item 现在起我们令 $\beta_j = \bra{\tilde\Psi_j}\ket{\tilde\Psi_j}$． % 未完成
\end{enumerate}

{\noindent \textbf{定理1}}
对以上定义的基底
\begin{equation}
\left( {1 + \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| + \left| {{\Psi _{j - 1}}} \right\rangle \left\langle {{\Psi _{j - 1}}} \right| + ... + \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right){\hat H^{j + 1}}\left| {{\Psi _0}} \right\rangle
\end{equation}
与
\begin{equation}
\left( {1 + \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| + \left| {{\Psi _{j - 1}}} \right\rangle \left\langle {{\Psi _{j - 1}}} \right| + ... + \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right)\hat H\left| {{\Psi _j}} \right\rangle 
\end{equation}
共线．故现在起采用后者进行正交化．

{\noindent \textbf{定理2}}
\begin{equation}
\left\langle {{\Psi _{j - 1}}} \right|\hat H\left| {{\Psi _j}} \right\rangle  = \sqrt {\left\langle {{{{\tilde \Psi }_j}}}
 \mathrel{\left | {\vphantom {{{{\tilde \Psi }_j}} {{{\tilde \Psi }_j}}}}
 \right. \kern-\nulldelimiterspace}
 {{{{\tilde \Psi }_j}}} \right\rangle }  = {\beta _j}
\end{equation}

\begin{enumerate}[resume]
\item 把 ${\hat H^2}\left| {{\Psi _0}} \right\rangle$ 进行施密特正交化，根据两个定理，正交化结果也可以写成
\begin{equation}
\begin{aligned}
\ket{{{\tilde \Psi }_2}}  &= \left( {1 -\ket{{\Psi _1}}  \bra {{\Psi _1}}  - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right)\hat H\left| {{\Psi _1}} \right\rangle \\
   &= \hat H\left| {{\Psi _1}} \right\rangle  - {\alpha _1}\left| {{\Psi _1}} \right\rangle  - {\beta _1}\left| {{\Psi _0}} \right\rangle \\ 
\end{aligned}
\end{equation}
\item 再次归一化  $\ket{\Psi_2} = \ket{\tilde\Psi_2}/\bra{\tilde\Psi_2}\ket{\tilde\Psi_2} = \ket{\tilde\Psi_2}/\beta_2$
\end{enumerate}

{\noindent \textbf{定理3}}
\begin{equation}\begin{aligned}
  \left| {{{\tilde \Psi }_{j + 1}}} \right\rangle  &= \left( {1 - \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right)\hat H\left| {{\Psi _j}} \right\rangle\\
&= \left( {1 - \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| - \left| {{\Psi _{j - 1}}} \right\rangle \left\langle {{\Psi _{j - 1}}} \right|} \right)\hat H\left| {{\Psi _j}} \right\rangle  \hfill \\
&= \hat H\left| {{\Psi _j}} \right\rangle  - {\alpha _j}\left| {{\Psi _j}} \right\rangle  - {\beta _j}\left| {{\Psi _j}} \right\rangle 
\end{aligned}\end{equation}
这就是最简洁的正交化公式．比起最原始的正交化
\begin{equation}
\left| {{{\tilde \Psi }_{j + 1}}} \right\rangle  = \left( {1 - \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right){\hat H^{j + 1}}\left| {{\Psi _0}} \right\rangle 
\end{equation}
定理 3 只用到了一个矩阵-矢量乘法，两个矢量数乘和两个矢量减法．

接下来只要对 $j = 2,4,5...K - 1$ 不断重复定理 3 中的正交化和归一化，就可以得到所有正交归一基底 $\ket{\Psi _j} $．

现在我们来求该基底下的 $\mat H$ 矩阵．根据 $\alpha_i$ 的定义以及定理 2 可以发现它们分别是矩阵的主对角元和副对角元．

{\noindent \textbf{定理4}}
在正交归一基底 $\ket{\Psi _j}$ 中， 矩阵 $\mat H$ 是对称三对角矩阵．所以我们已经顺便求出了所有的矩阵元!
\begin{equation}
\mat H =
\begin{pmatrix}
\alpha _0 & \beta _1 &&& \\ 
\beta _1 & \alpha _1 & \beta _2 && \\ 
 & \beta _2 & \alpha _2 & \ddots&  \\ 
& & \ddots& \ddots & {\beta _{K - 1}} \\
&&&\beta_{K - 1} &{\alpha _{K - 1}}
\end{pmatrix}\end{equation}
该矩阵具有维数小，易求本征问题的优势．


\subsection{定理1证明}

根据施密特正交化的性质，Krilov 基底的前 $j$ 项的与 $\ket{\Psi_0}\dots\ket{\Psi_j}$ 展开同一空间．所以 $\hat H^j\ket{\Psi_0} = c_j\ket{\Psi_j} +\dots + c_0 \ket{\Psi_0}$，所以（以下所有系数 只是用来表示线性组合，具体值不重要）
\begin{equation}\begin{aligned}
  {H^{j + 1}}\left| {{\Psi _0}} \right\rangle  &= {c_j}H\left| {{\Psi _j}} \right\rangle  + H\left( {{c_{j - 1}}\left| {{\Psi _{j - 1}}} \right\rangle ... + {c_0}\left| {{\Psi _0}} \right\rangle } \right)  \\
   &= {c_j}H\left| {{\Psi _j}} \right\rangle  + H\left( {{{c'}_{j - 1}}{H^{j - 1}}\left| {{\Psi _0}} \right\rangle  + {{c'}_{j - 2}}{H^{j - 2}}\left| {{\Psi _0}} \right\rangle ... + {{c'}_0}\left| {{\Psi _0}} \right\rangle } \right)  \\
   &= {c_j}H\left| {{\Psi _j}} \right\rangle  + \left( {{{c'}_{j - 1}}{H^j}\left| {{\Psi _0}} \right\rangle  + {{c'}_{j - 2}}{H^{j - 1}}\left| {{\Psi _0}} \right\rangle ... + {{c'}_0}\left| {{\Psi _0}} \right\rangle } \right)  \\
   &= {c_j}H\left| {{\Psi _j}} \right\rangle  + \left( {{{c''}_{j - 1}}\left| {{\Psi _j}} \right\rangle  + {{c''}_{j - 2}}\left| {{\Psi _{j - 1}}} \right\rangle ... + {{c''}_0}\left| {{\Psi _0}} \right\rangle } \right)  \\ 
\end{aligned}\end{equation}
把 $\hat H^{j+1}\ket{\Psi_0}$ 施密特正交归一化
\begin{equation}
\begin{aligned}
&{\phantom{=}}\left( {1 - \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right){H^{j + 1}}\left| {{\Psi _0}} \right\rangle  \hfill \\
&= {c_j}\left( {1 - \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right)H\left| {{\Psi _j}} \right\rangle  \hfill \\
&{\phantom{=}}+ \left( {1 - \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right)\left( {{{c''}_{j - 1}}\left| {{\Psi _j}} \right\rangle  + {{c''}_{j - 2}}\left| {{\Psi _{j - 1}}} \right\rangle ... + {{c''}_0}\left| {{\Psi _0}} \right\rangle } \right) \hfill \\
&= {c_j}\left( {1 - \left| {{\Psi _j}} \right\rangle \left\langle {{\Psi _j}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right)H\left| {{\Psi _j}} \right\rangle  \hfill \\ 
\end{aligned}
\end{equation}

\subsection{定理 2 证明}
要证 $\left\langle {{\Psi _{j - 1}}} \right|\hat H\left| {{\Psi _j}} \right\rangle  = \sqrt {\left\langle {{{{\tilde \Psi }_j}}}
 \mathrel{\left | {\vphantom {{{{\tilde \Psi }_j}} {{{\tilde \Psi }_j}}}}
 \right. \kern-\nulldelimiterspace}
 {{{{\tilde \Psi }_j}}} \right\rangle }$， 即证 $\left\langle {{\Psi _{j - 1}}} \right|\hat H\left| {{{\tilde \Psi }_j}} \right\rangle  = \left\langle {{{{\tilde \Psi }_j}}}
 \mathrel{\left | {\vphantom {{{{\tilde \Psi }_j}} {{{\tilde \Psi }_j}}}}
 \right. \kern-\nulldelimiterspace}
 {{{{\tilde \Psi }_j}}} \right\rangle$， 即证 $\left\langle {{{{\tilde \Psi }_j}}}
 \mathrel{\left | {\vphantom {{{{\tilde \Psi }_j}} {{{\tilde \Psi }_j}}}}
 \right. \kern-\nulldelimiterspace}
 {{{{\tilde \Psi }_j}}} \right\rangle  = \left\langle {{{{\tilde \Psi }_j}}}
 \mathrel{\left | {\vphantom {{{{\tilde \Psi }_j}} {\hat H{\Psi _{j - 1}}}}}
 \right. \kern-\nulldelimiterspace}
 {{\hat H{\Psi _{j - 1}}}} \right\rangle $
而
\begin{equation}
\left\langle {{{{\tilde \Psi }_j}}}
 \mathrel{\left | {\vphantom {{{{\tilde \Psi }_j}} {{{\tilde \Psi }_j}}}}
 \right. \kern-\nulldelimiterspace}
 {{{{\tilde \Psi }_j}}} \right\rangle  = \left\langle {{{\tilde \Psi }_j}} \right|\left( {1 - \left| {{\Psi _{j - 1}}} \right\rangle \left\langle {{\Psi _{j - 1}}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right)\hat H\left| {{\Psi _{j - 1}}} \right\rangle 
\end{equation}
由于上式中  $\left\langle {{{\tilde \Psi }_j}} \right|\left( {\left| {{\Psi _{j - 1}}} \right\rangle \left\langle {{\Psi _{j - 1}}} \right| - ... - \left| {{\Psi _0}} \right\rangle \left\langle {{\Psi _0}} \right|} \right) = 0$
\begin{equation}
 \left\langle {{{{\tilde \Psi }_j}}}
 \mathrel{\left | {\vphantom {{{{\tilde \Psi }_j}} {{{\tilde \Psi }_j}}}}
 \right. \kern-\nulldelimiterspace}
 {{{{\tilde \Psi }_j}}} \right\rangle  = \left\langle {{{\tilde \Psi }_j}} \right|\hat H\left| {{\Psi _{j - 1}}} \right\rangle
\end{equation}

\subsection{定理 3 证明}

要证明定理 3，即证，对 $n \leqslant j - 2$， 有 $\left\langle {{\Psi _n}} \right|H\left| {{\Psi _j}} \right\rangle  = 0$， $\hat H$ 为厄米算符时即证 $\left\langle {{\Psi _j}} \right|H\left| {{\Psi _n}} \right\rangle  = 0$，即证对 $m \geqslant j + 2$，  $\left\langle {{\Psi _m}} \right|H\left| {{\Psi _j}} \right\rangle  = 0$． 在定理 1 的证明类似，我们知道
\begin{equation}\begin{aligned}
  H\left| {{\Psi _j}} \right\rangle  &= H\left( {{c_j}{H^j}\left| {{\Psi _0}} \right\rangle  + ... + {c_0}\left| {{\Psi _0}} \right\rangle } \right) = {c_j}{H^{j + 1}}\left| {{\Psi _0}} \right\rangle  + ... + {c_0}H\left| {{\Psi _0}} \right\rangle \\
&= {{c'}_j}\left| {{\Psi _{j + 1}}} \right\rangle  + ... + {{c'}_0}\left| {{\Psi _0}} \right\rangle  \hfill \\ 
\end{aligned}\end{equation}
所以对 $m \geqslant j + 2$ 有
\begin{equation}
\left\langle {{\Psi _m}} \right|H\left| {{\Psi _j}} \right\rangle  = \left\langle {{\Psi _m}} \right|\left( {{{c'}_j}\left| {{\Psi _{j + 1}}} \right\rangle  + ... + {{c'}_0}\left| {{\Psi _0}} \right\rangle } \right) = 0
\end{equation}

\subsection{定理 4 证明}

首先证明 $\mat H$ 是三对角矩阵．即证 $m \geqslant j + 2$ 或 $m \leqslant j - 2$ 时 {$\left\langle {{\Psi _m}} \right|H\left| {{\Psi _j}} \right\rangle  = 0$．}
$m \geqslant j + 2$ 的情况在证明3中已经证明，只需证明另一种情况．
对厄米矩阵， $\left\langle {{\hat H{\Psi _m}}}
 \mathrel{\left | {\vphantom {{\hat H{\Psi _m}} {{\Psi _j}}}}
 \right. \kern-\nulldelimiterspace}
 {{{\Psi _j}}} \right\rangle  = \left\langle {{\Psi _m}} \right| \hat H\left| {{\Psi _j}} \right\rangle  = 0$， 取复共轭，即 $\left\langle {{\Psi _j}} \right|\hat H\left| {{\Psi _m}} \right\rangle  = 0$． 可见左边的角标的确小于等于右边的角标减二，证毕．

然后证明 $\mat H$ 是实矩阵，考虑到厄米矩阵 ${H_{mn}} = H_{nm}^ * $ 的性质，只需要证明 ${H_{j,j + 1}}$ 是实数．对任意 $j = 2....K - 1$
\begin{equation}\begin{aligned}
  {\hat H_{j,j + 1}} &= \left\langle {{\Psi _j}} \right|\hat H\left| {{\Psi _{j + 1}}} \right\rangle  = \left\langle {{\Psi _j}} \right|\hat H\left( {\hat H\left| {{\Psi _j}} \right\rangle  - {\alpha _j}\left| {{\Psi _j}} \right\rangle  - {\beta _j}\left| {{\Psi _{j - 1}}} \right\rangle } \right) \\
   &= \left\langle {{\Psi _j}} \right|{\hat H^2}\left| {{\Psi _j}} \right\rangle  - {\alpha _j}\left\langle {{\Psi _j}} \right|\hat H\left| {{\Psi _j}} \right\rangle  - {\beta _j}\left\langle {{\Psi _j}} \right|\hat H\left| {{\Psi _{j - 1}}} \right\rangle
\end{aligned} \end{equation}
易证 $\left\langle {{\Psi _j}} \right|{\hat H^2}\left| {{\Psi _j}} \right\rangle $， $\alpha_j$ 及 $\beta_j$ 是实数，只需要证明 $\left\langle {{\Psi _j}} \right|\hat H\left| {{\Psi _{j - 1}}} \right\rangle $ 是实数即可，即证 $\left\langle {{\Psi _{j - 1}}} \right|\hat H\left| {{\Psi _j}} \right\rangle $ 是实数，重复上述论证，即证 $\left\langle {{\Psi _{j - 2}}} \right|\hat H\left| {{\Psi _{j - 1}}} \right\rangle $ 是实数，...，即证 $\left\langle {{\Psi _1}} \right|\hat H\left| {{\Psi _0}} \right\rangle $ 是实数，即证 $\left\langle {{\Psi _0}} \right|\hat H\left| {{{\Psi }_1}} \right\rangle $ 是实数，即证 $\left\langle {{\Psi _0}} \right|\hat H\left| {{{\tilde \Psi }_1}} \right\rangle $ 是实数．而
\begin{equation}
\left\langle {{\Psi _0}} \right|\hat H\left| {{{\tilde \Psi }_1}} \right\rangle  = \left\langle {{\Psi _0}} \right|\hat H\left( {\hat H\left| {{\Psi _0}} \right\rangle  - {\alpha _0}\left| {{\Psi _0}} \right\rangle } \right) = \left\langle {{\Psi _0}} \right|{\hat H^2}\left| {{\Psi _0}} \right\rangle  - {\alpha _0}\left\langle {{\Psi _0}} \right|\hat H\left| {{\Psi _0}} \right\rangle 
\end{equation}
显然是实数．以上的思路是数学归纳法的逆过程．
